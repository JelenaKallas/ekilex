<!DOCTYPE html>
<html lang="et" xmlns:th="http://www.thymeleaf.org">
<head th:replace="common :: common_header(~{::title},~{::links})">
<title th:text="#{search.title}">EVE otsing</title>
<th:block th:fragment="links">
  <script type="text/javascript" th:src="@{/view/js/recorder.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/eve-search.js}"></script>
</th:block>
</head>
<body>
  <div class="container-fluid">
    <div class="d-flex flex-row">
      <p class="card-text">
        <a th:href="@{/}">
          <span th:text="${appData.appName + ' ' + appData.appVersion}"></span>
        </a>
      </p>
    </div>
    <div class="card mt-4">
      <div class="card-header">
        <h5 class="card-title" th:text="#{search.title}">Vormi otsing</h5>
      </div>
      <div class="card-body">
        <form th:action="@{/search}">
          <div class="form-row">
            <div class="col-8">
              <div class="form-group row">
                <label class="col-auto col-form-label">Otsing</label>
                <div class="col-6">
                  <input type="text" class="form-control" name="searchFilter" th:value="${searchFilter}" placeholder="sisesta otsitav vorm">
                </div>
                <button type="submit" id="serch-btn" class="btn btn-primary">Otsi</button>
                <button type="button" id="serch-korp-btn" class="ml-2 btn btn-primary">Korp</button>
                <button type="button" id="start-rec-btn" class="ml-2 btn btn-info">Dikteeri</button>
                <button type="button" id="stop-rec-btn" class="ml-2 btn btn-info" hidden>Lõpeta</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div name="korp-section"></div>

    <th:block th:fragment="korp" th:if="${sentences != null}">
      <div class="card mt-4" name="korp-section">
        <div class="card-header">
          <button type="button" class="btn btn-primary" onclick="closeKorpSection()">Sulge</button>
        </div>
        <div name="korp-body" class="card-body" style="overflow-x: scroll">
          <span th:if="${#lists.isEmpty(sentences)}">Korp päring tagastas tühja vastuse.</span>
          <table th:if="${not #lists.isEmpty(sentences)}">
            <tr th:each="sentence, iter : ${sentences}" th:style="${iter.even} ? 'background-color: rgba(0, 0, 0, 0.03)'">
              <td style="text-align: right; white-space:nowrap;" th:text="${sentence.leftPart}"></td>
              <td style="text-align: center; white-space:nowrap; vertical-align: top; color:blueviolet" th:text="${sentence.middlePart}"></td>
              <td style="text-align: left; white-space:nowrap;" th:text="${sentence.rightPart}"></td>
            </tr>
          </table>
        </div>
      </div>
    </th:block>

    <div class="mt-4 ml-4" th:if="${wordsFoundBySearch != null}">
      <table id="results" class="w-100">
        <tr th:each="word : ${wordsFoundBySearch}">
          <td class="w-100">
            <span th:text="${word.value}">vorm 1</span>
            <span th:text="${'(' + word.homonymNumber + ')'}" th:if="${word.homonymNumber > 0}"></span>
            <button type="button" class="btn btn-link" th:data-id="${word.formId}" name="details">Detailid</button>
            <div th:name="${word.formId}+'_details'"></div>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <th:block th:fragment="details" th:if="${details != null}">
    <div th:name="${detailsName}" class="pl-4">
      <div class="float-left w-25">
        <th:block th:each="form : ${details.forms}">
          <span th:text="${form.value}"></span>
          (
          <span th:text="${form.morphCode + '-' + form.morphValue}"></span>
          <span th:text="${' | ' + form.displayForm}" th:unless="${#strings.isEmpty(form.displayForm)}"></span>
          <span th:text="${' | ' + form.vocalForm}" th:unless="${#strings.isEmpty(form.vocalForm)}"></span>)
          <a href="javascript:void(0)" class="badge badge-info" th:unless="${#strings.isEmpty(form.soundFile)}"
             th:data-url-to-sound="@{'/files/sounds/' + ${form.soundFile}}" th:onclick="'generateVoiceAndPlay(this)'">
            <i class="fa fa-volume-up" aria-hidden="true"></i>
          </a>
          <br>
        </th:block>
      </div>
      <div class="float-left w-75">
        <th:block th:each="lexeme,meaningIter : ${details.lexemes}">
          <span th:each="word,wordIter : ${lexeme.words}">
            <a style="color: #1e7e34" class="mr-2" th:href="@{'/search?searchFilter=' + ${word.value}}" th:text="${word.value}"></a>
            <span th:unless="${wordIter.last}">|&nbsp;</span>
          </span>
          <span th:text="${lexeme.level1 + '.' + lexeme.level2 + '.' + lexeme.level3}" th:if="${lexeme.level1 > 0}"></span>
          <span th:each="dataset : ${lexeme.datasets}" th:text="${dataset}" class="pr-2"></span>
          <ul>
            <th:block th:each="definition : ${lexeme.definitions}">
              <li>
                <span th:text="${definition.value}"></span>
                <a href="javascript:void(0)" class="badge badge-info"
                    th:if="${definition.lang == 'est'}" th:data-words="${definition.value}" th:onclick="'generateVoiceAndPlay(this)'">Kuula</a>
              </li>
            </th:block>
          </ul>
          <div th:if="${not #lists.isEmpty(lexeme.rections)}" style="margin-top: -0.5em;">
            <table th:each="rection,rectionIter : ${lexeme.rections}">
              <tr>
                <td style="vertical-align: text-top; padding-right: 1em">
                  <span th:text="${rection.value}"></span>
                </td>
              </tr>
              <tr>
                <td>
                  <table th:each="usageMeaning,usageMeaningIter : ${rection.usageMeanings}">
                    <tr th:each="usage : ${usageMeaning.usages}">
                      <td>
                        <span th:text="${usage.value}"></span>
                        <a href="javascript:void(0)" class="badge badge-info"
                            th:if="${usage.lang == 'est'}" th:data-words="${usage.value}" th:onclick="'generateVoiceAndPlay(this)'">Kuula</a>
                      </td>
                    </tr>
                    <tr th:each="usageTranslation : ${usageMeaning.usageTranslations}">
                      <td th:text="${usageTranslation.value}"></td>
                    </tr>
                    <tr th:each="usageDefinition : ${usageMeaning.usageDefinitions}">
                      <td>
                        <span th:text="${usageDefinition.value}"></span>
                        <a href="javascript:void(0)" class="badge badge-info"
                           th:if="${usageDefinition.lang == 'est'}" th:data-words="${usageDefinition.value}" th:onclick="'generateVoiceAndPlay(this)'">Kuula</a>
                      </td>
                    </tr>
                    <tr th:unless="${usageMeaningIter.last}">
                      <td>
                        <hr />
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </div>
          <div th:each="meaningFreeform : ${lexeme.meaningFreeforms}">
            <img th:src="@{'/files/images/' + ${meaningFreeform.valueText}}" th:if="${meaningFreeform.type.toString() == 'IMAGE_FILE'}"></img>
          </div>
          <hr th:unless="${meaningIter.last}">
        </th:block>
      </div>
    </div>
  </th:block>

  <script th:inline="javascript">
    initializeRecording(/*[[${speechRecognitionServiceUrl}]]*/'/');
  	initialize();
  </script>
</body>
</html>
