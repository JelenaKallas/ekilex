<!DOCTYPE html>
<html lang="et" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="common :: common_header(_,_)">
</head>
<body class="body-with-navbar">
  <th:block th:replace="common :: nav_bar"></th:block>
  <div class="container-fluid">
    <div class="card mt-4 shadow">
      <div class="card-header">
        <h5 class="card-title">KasutajaÃµiguste haldus</h5>
      </div>
      <div class="card-body">
        <div class="float-left mt-3 w-100">
          <table class="w-100">
            <tr>
              <th>Nimi</th>
              <th>E-post</th>
              <th>Admin</th>
              <th>Lubatud</th>
              <th>Avaldused</th>
              <th>Load</th>
            </tr>
            <tr>
              <td colspan="6">
                <hr />
              </td>
            </tr>
            <th:block th:each="userPerm : ${ekiUserPermissions}">
              <tr>
                <td>
                  <span th:text="${userPerm.name}"></span>
                </td>
                <td>
                  <span th:text="${userPerm.email}"></span>
                </td>
                <td>
                  <input type="checkbox" th:checked="${userPerm.admin}"/>
                </td>
                <td>
                  <input type="checkbox" th:checked="${userPerm.approved}"/>
                </td>
                <td>
                  <span th:if="${#lists.isEmpty(userPerm.applications)}">-</span>
                  <th:block th:each="userApplication,userApplicationIter : ${userPerm.applications}">
                    <div class="row">
                      <span th:text="${#dates.format(userApplication.created, 'dd.MM.yyyy HH:mm')}" class="col-3"></span>
                      <span th:if="${userApplication.datasetCodes != null}" th:text="${userApplication.datasetCodes}" class="col"></span>
                    </div>
                    <div class="row" th:if="${userApplication.comment != null}">
                      <span th:text="${userApplication.comment}" class="col"></span>                      
                    </div>
                  </th:block>
                </td>
                <td>
                  <th:block th:each="datasetPerm,datasetPermIter : ${userPerm.datasetPermissions}">
                    <span th:text="${datasetPerm.datasetCode}"></span>
                    <span th:text="${datasetPerm.authItem}"></span>
                    <span th:if="${datasetPerm.authLang != null}">
                      <span th:text="${datasetPerm.authLang}"></span>
                    </span>
                    <span th:unless="${datasetPermIter.last}"> | </span>
                  </th:block>
                </td>
              </tr>
            </th:block>
          </table>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
