<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>Search components</title>
</head>
<body>

<th:block th:fragment="search_form">
  <div class="form-row">
    <div class="col-12">
      <div class="form-group row">
        <input type="hidden" id="searchMode" name="searchMode" th:value="${searchMode}">
        <div class="col-2">
          <button type="button" class="btn btn-info" id="searchModeBtn" th:text="${searchMode == 'SIMPLE' ? 'Detailotsing' : 'Lihtotsing'}">search toggle</button>
        </div>
        <div class="col-4" th:if="${datasets}" th:insert="~{::dataset_select}"></div>
      </div>
    </div>
  </div>
  <th:block th:replace="::detail_search"></th:block>
  <th:block th:replace="::simple_search"></th:block>
  <script th:inline="javascript">
      initaliseSearchForm()
  </script>
</th:block>

<th:block th:fragment="simple_search">
  <div class="form-row" th:name="simpleSearch" th:hidden="${searchMode != 'SIMPLE'}">
    <div class="col-12">
      <div class="form-group row">
        <label class="col-auto col-form-label">Otsing</label>
        <div class="col-5">
          <input type="text" class="form-control" name="searchFilter" th:value="${searchFilter}" placeholder="sisesta otsitav vorm">
        </div>
        <div class="col-2">
          <button type="submit" class="btn btn-primary">Otsi</button>
        </div>
      </div>
    </div>
  </div>
</th:block>

<th:block th:fragment="detail_search">
  <div class="form-row" th:name="detailSearch" th:hidden="${searchMode != 'DETAIL'}">
    <div class="col-10">
      <div class="form-group row" th:each="criterion, stat : ${detailSearch.searchCriteria}" name="detailCondition" th:data-index="${stat.index}">
        <div class="col-2">
          <select class="form-control" th:name="'searchCriteria[' + ${stat.index} + '].searchKey'">
            <option th:each="key : ${T(eki.ekilex.constant.SearchKey).values()}"
                    th:value="${key}"
                    th:selected="${criterion.searchKey == key}"
                    th:text="#{|search.key.${key.name()}|}">searchKey</option>
          </select>
        </div>
        <div class="col-2">
          <select class="form-control" th:name="'searchCriteria[' + ${stat.index} + '].searchOperand'">
            <option th:each="operand : ${criterion.searchKey.getOperands()}"
                    th:value="${operand}"
                    th:selected="${criterion.searchOperand == operand}"
                    th:text="#{|search.operand.${operand.name()}|}">searchOperand</option>
          </select>
        </div>
        <div class="col-4">
          <input type="text" class="form-control" th:value="${criterion.searchValue}" th:name="'searchCriteria[' + ${stat.index} + '].searchValue'">
        </div>
        <div class="col-1">
          <button type="button" class="btn btn-success btn-sm mt-1" name="addDetailConditionBtn">
            <i class="fa fa-plus" aria-hidden="true"></i>
          </button>
          <button type="button" class="btn btn-danger btn-sm mt-1" name="removeDetailConditionBtn">
            <i class="fa fa-minus" aria-hidden="true"></i>
          </button>
        </div>
      </div>
      <div id="searchOperandTemplates" hidden>
        <div th:each="key : ${T(eki.ekilex.constant.SearchKey).values()}">
          <div th:name="${key}">
            <option th:each="operand : ${key.getOperands()}"
                    th:value="${operand}"
                    th:text="#{|search.operand.${operand.name()}|}">searchOperand</option>
          </div>
        </div>
      </div>
    </div>
    <div class="col-2">
      <button type="submit" class="btn btn-primary">Otsi</button>
    </div>
  </div>
  <script th:inline="javascript">
      initialiseDeatailSearch()
  </script>
</th:block>

<th:block th:fragment="dataset_select">
    <button class="btn btn-info" type="button" data-toggle="collapse" data-target="#dataset_select" aria-expanded="false" aria-controls="dataset_select">
      Sõnastiku valik
    </button>
    <div id="dataset_select" class="collapse">
      <button class="btn btn-secondary btn-sm mt-2" type="button" onclick="selectDatasets(true)">Vali kõik</button>
      <button class="btn btn-secondary btn-sm mt-2" type="button" onclick="selectDatasets(false)">Eemalda valikud</button>
      <div class="form-check mt-2" th:each="dict : ${datasets}">
        <input class="form-check-input" type="checkbox" th:value="${dict.key}" th:name="dicts" th:checked="${#lists.contains(selectedDatasets, dict.key)}">
        <label class="form-check-label" th:text="${dict.value}">Default checkbox</label>
      </div>
    </div>
</th:block>

</body>
</html>